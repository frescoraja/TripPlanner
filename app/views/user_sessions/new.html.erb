<% provide(:title, 'Sign In') %>
<div class="user-forms">
  <div class="row">
    <div class="col-md-6 col-md-offset-3">
      <%= form_for :user_session, url: user_sessions_url, html: { id: 'new_user_session' } do |f| %>

        <%= f.label :login %>
        <%= f.text_field :login, class: 'form-control', placeholder: 'Username' %>
        <br>
        <%= f.label :password %>
        <%= f.password_field :password, class: 'form-control' %>
        <br>
        <%= f.label :password_confirmation %>
        <%= f.password_field :password_confirmation, class: 'form-control' %>
        <br>
        <center>
          <%= f.submit 'Log in', class: 'btn btn-primary' %>
          <%= f.submit 'Guest Log in', class: 'guest-submit btn btn-primary' %>
        <% end %>
          <p>New user? <%= link_to "Sign up now!", new_user_url %></p>
        </center>
    </div>
  </div>
</div>

<script>
var $guest = $('.guest-submit');
$guest.click(function (e) {
  e.preventDefault();
  var $loginInput = $('#user_session_login');
  var $pwInput = $('#user_session_password');
  var $pwConfInput = $('#user_session_password_confirmation');

  autoType("Guest_User", $loginInput, function () {
    autoType("password", $pwInput, function () {});
    autoType("password", $pwConfInput, function () {
      $('#new_user_session').submit();
    })
  })

  function autoType (string, $el, cb) {
    var typer = setInterval(function () {
      $el.val($el.val() + string.slice(0, 1));
      string = string.substr(1);
      if (string.length === 0) {
        clearInterval(typer);
        cb();
      }
    }, 65);
  }

});
</script>
